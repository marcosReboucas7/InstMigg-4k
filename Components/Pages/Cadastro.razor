@page "/cadastro"
@using InstMiggD.Entities
@using InstMiggD.Services
@inject IClientService ClientService
@rendermode InteractiveServer

<style>
    /* Fundo geral e fonte */
    body {
        font-family: Arial, Helvetica, sans-serif;
        background-color: #0b1e39; /* azul escuro */
        color: #ffffff; /* letras brancas */
        text-align: left;
        margin: 0;
        padding: 0;
    }

    

    .logo {
        display: block;
        margin: 10px auto;
        width: 230px; /* logo maior */
        height: auto;
        border-radius: 16px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.4);
    }

    h1 {
        color: #ffffff;
        font-size: 2.4em;
        margin-bottom: 10px;
    }

    /* Corpo do texto */
    main {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px 40px;
        line-height: 1.6;
    }

    a {
        color: #ffcc00; /* amarelo suave */
        text-decoration: none;
        font-weight: bold;
    }

        a:hover {
            text-decoration: underline;
        }

    /* Lista */
    ul {
        list-style: disc;
        text-align: left;
        display: inline-block;
        margin-top: 20px;
        color: #e0e0e0;
    }

    /* Rodapé (opcional futuramente) */
    footer {
        margin-top: 30px;
        padding: 10px;
        font-size: 0.9em;
        color: #ccc;
    }
</style>

<h3>Cadastro de Clientes</h3>
<hr />

<EditForm Model="@client" OnValidSubmit="@SalvarCliente">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group mb-3">
        <label for="name">Nome do Cliente</label>
        <InputText id="name" class="form-control" @bind-Value="client.Name" />
    </div>

    <div class="form-group mb-3">
        <label for="seller">Vendedor</label>
        <InputText id="seller" class="form-control" @bind-Value="client.CreatedBy" />
    </div>

    <div class="form-group mb-3">
        <label for="type">Tipo de Cliente</label>
        <InputSelect id="type" class="form-control" @bind-Value="client.Type">
            <option value="">Selecione...</option>
            <option value="@ClientType.Instalacao">Instalação</option>
            <option value="@ClientType.Migracao">Migração</option>
        </InputSelect>
    </div>

    <div class="form-group mb-3">
        <label for="date">Data</label>
        <InputDate id="date" class="form-control" @bind-Value="client.CreatedAt" />
    </div>

    @if (client.Type == ClientType.Instalacao)
    {
        <div class="form-group mb-3">
            <label for="price">Valor do Contrato</label>
            <InputNumber id="price" class="form-control" @bind-Value="client.Price" />
        </div>

        <div class="form-group mb-3">
            <label for="contract">Contrato</label>
            <InputText id="contract" class="form-control" @bind-Value="client.Contract" />
        </div>
    }
    else if (client.Type == ClientType.Migracao)
    {
        <div class="form-group mb-3">
            <label for="newPrice">Novo Valor do Contrato</label>
            <InputNumber id="newPrice" class="form-control" @bind-Value="client.NewPrice" />
        </div>

        <div class="form-group mb-3">
            <label for="newContract">Novo Contrato</label>
            <InputText id="newContract" class="form-control" @bind-Value="client.NewContract" />
        </div>
    }

    <hr />

    <button type="submit" class="btn btn-primary">Salvar</button>
</EditForm>

@if (mensagem is not null)
{
    <p class="mt-3 text-success">@mensagem</p>
}

@code {
    private Client client = new();
    private string? mensagem;

    private async Task SalvarCliente()
    {
        try
        {
            await ClientService.CreateClientAsync(client);
            mensagem = "Cliente salvo com sucesso!";
            client = new Client();
            StateHasChanged();
        }
        catch (Exception ex)
        {
            mensagem = $"Erro ao salvar: {ex.Message}";
        }
    }
}
